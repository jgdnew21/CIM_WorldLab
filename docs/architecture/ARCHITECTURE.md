å¤ªå¥½äº†ï¼Œè¿™ä¸€æ­¥**éžå¸¸é€‚åˆâ€œå­¦ä¹  & æ•´ç†æ¨¡å¼â€**ã€‚
æˆ‘ä¼šç›´æŽ¥å¸®ä½ æŠŠ `docs/architecture/ARCHITECTURE.md` **å‡çº§æˆä¸€é¡µâ€œåˆ†å±‚åœ°å›¾â€**ï¼Œé£Žæ ¼æ˜¯ï¼š

* âœ… **ä¸€é¡µå°±èƒ½çœ‹æ‡‚å…¨ç³»ç»Ÿ**
* âœ… é¢å‘ã€Œå·¥ç¨‹å­¦ä¹  / æ•™å­¦ / å¤ç›˜ã€
* âœ… ä¸è®²å®žçŽ°ç»†èŠ‚ï¼Œåªè®²**åˆ†å±‚èŒè´£ + å»ºæ¨¡é€»è¾‘**
* âœ… å®Œå…¨è´´åˆä½ çŽ°åœ¨çš„ **çœŸå®žç›®å½•ç»“æž„ï¼ˆStep18 å·²å®Œæˆæ€ï¼‰**

ä½ å¯ä»¥**æ•´é¡µç›´æŽ¥è¦†ç›–åŽŸæ–‡ä»¶**ï¼Œæˆ–å¦å­˜ä¸º `ARCHITECTURE_MAP.md`ã€‚

---

# CIM_WorldLab Architecture Map

**ï¼ˆä¸€é¡µåˆ†å±‚åœ°å›¾ / Architecture at a Glanceï¼‰**

---

## ä¸€ã€ç³»ç»Ÿä¸€å¥è¯å®šä¹‰ï¼ˆSystem Statementï¼‰

**CIM_WorldLab æ˜¯ä¸€ä¸ªã€Œäº‹ä»¶é©±åŠ¨ã€å¯å›žæ”¾ã€å¯è§£é‡Šçš„ä¸–ç•Œæ¨¡æ‹Ÿç³»ç»Ÿã€ã€‚**

å®ƒæŠŠçŽ°å®žä¸–ç•Œä¸­çš„å·¥ç¨‹è¿‡ç¨‹æ‹†è§£ä¸ºï¼š

> **äº‹å®ž â†’ åˆ¤æ–­ â†’ æ‰§è¡Œ â†’ è®°å¿† â†’ æ±‡æŠ¥**

å¹¶ç”¨æ¸…æ™°çš„åˆ†å±‚ç»“æž„ï¼ŒæŠŠè¿™äº›è¿‡ç¨‹å˜æˆ**å¯æµ‹è¯•ã€å¯æ•™å­¦ã€å¯å¤ç›˜çš„å·¥ç¨‹ç³»ç»Ÿ**ã€‚

---

## äºŒã€æ•´ä½“åˆ†å±‚æ€»è§ˆï¼ˆLayer Overviewï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Presentation Layer     â”‚
â”‚   CLI / HTTP / Scripts        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Runtime Orchestration  â”‚
â”‚      world/runtime            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Domain Core (The World)     â”‚
â”‚ events / policy / state       â”‚
â”‚ reducer / actions             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Observation & Memory        â”‚
â”‚ metrics / persistence         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   External World Interface    â”‚
â”‚ gateway / plugins             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€å„å±‚èŒè´£è¯´æ˜Žï¼ˆWhat Each Layer Doesï¼‰

### 1ï¸âƒ£ Presentation Layerï¼ˆå…¥å£ä¸Žå±•ç¤ºå±‚ï¼‰

**ä½ç½®**

```
src/cim_worldlab/cli
src/cim_worldlab/http_server.py
scripts/
plugins/examples/
```

**èŒè´£**

* æä¾› CLI / HTTP æŽ¥å£
* æŠŠå¤–éƒ¨è¾“å…¥é€å…¥ç³»ç»Ÿ
* æŠŠç³»ç»Ÿç»“æžœä»¥ã€Œäººèƒ½è¯»æ‡‚ã€çš„æ–¹å¼å±•ç¤º

**ä¸è´Ÿè´£**

* ä¸ç†è§£ä¸šåŠ¡è§„åˆ™
* ä¸ç»´æŠ¤ä¸–ç•ŒçŠ¶æ€
* ä¸äº§ç”Ÿåˆ¤æ–­é€»è¾‘

ðŸ‘‰ **çŽ°å®žå¯¹åº”**ï¼šæ“ä½œå° / è°ƒè¯•ç»ˆç«¯ / æ•™å­¦æŠ•å±

---

### 2ï¸âƒ£ Runtime Orchestrationï¼ˆè¿è¡Œç¼–æŽ’å±‚ï¼‰

**ä½ç½®**

```
src/cim_worldlab/world/runtime/
```

**èŒè´£**

* ä¸–ç•Œçš„â€œä¸»å¾ªçŽ¯ / è°ƒåº¦å™¨â€
* æŽ¥æ”¶è¾“å…¥äº‹ä»¶
* è°ƒç”¨ policy ç”Ÿæˆåˆ¤æ–­
* è‡ªåŠ¨ç”Ÿæˆ ACTION_EXECUTED ç•™ç—•
* ç»Ÿä¸€ record äº‹ä»¶ï¼ˆlog / state / persistenceï¼‰

**æ ¸å¿ƒåŽŸåˆ™**

* runtime åª**ç¼–æŽ’æµç¨‹**
* ä¸ç›´æŽ¥å†™ä¸šåŠ¡è§„åˆ™
* ä¸ç›´æŽ¥ç®—æŒ‡æ ‡

ðŸ‘‰ **çŽ°å®žå¯¹åº”**ï¼šå·¥åŽ‚è°ƒåº¦ç³»ç»Ÿ / ä¸­æŽ§ç³»ç»Ÿ

---

### 3ï¸âƒ£ Domain Core â€“ The Worldï¼ˆä¸–ç•Œæ ¸å¿ƒå±‚ï¼‰

è¿™æ˜¯ç³»ç»Ÿçš„â€œå·¥ç¨‹æ–‡æ˜Žæ ¸å¿ƒâ€ã€‚

#### 3.1 Eventsï¼ˆä¸–ç•Œå‘ç”Ÿäº†ä»€ä¹ˆï¼‰

```
src/cim_worldlab/world/events/
```

* Event / ExternalInput / PolicyDecision / ActionExecuted
* æ‰€æœ‰â€œå‘ç”Ÿè¿‡çš„äº‹â€éƒ½å¿…é¡»å˜æˆäº‹ä»¶

ðŸ‘‰ **çŽ°å®žå¯¹åº”**ï¼šé»‘åŒ£å­ / ç”Ÿäº§å±¥åŽ† / å®¡è®¡æ—¥å¿—

---

#### 3.2 Policyï¼ˆä¸–ç•Œå¦‚ä½•åˆ¤æ–­ï¼‰

```
src/cim_worldlab/world/policy/
```

* æŠŠäº‹å®žï¼ˆEXTERNAL_INPUTï¼‰è½¬åŒ–ä¸ºåˆ¤æ–­ï¼ˆPOLICY_DECISIONï¼‰
* è¾“å‡º `suggested_action` + `reason`

ðŸ‘‰ **çŽ°å®žå¯¹åº”**ï¼šSOP / å·¥ç¨‹ç»éªŒ / è§„åˆ™å¼•æ“Ž
ðŸ‘‰ **å…³é”®å»ºæ¨¡åŽŸåˆ™**ï¼šåˆ¤æ–­ â‰  æ‰§è¡Œ

---

#### 3.3 Actionsï¼ˆä¸–ç•Œèƒ½åšä»€ä¹ˆï¼‰

```
src/cim_worldlab/world/actions/
```

* å®šä¹‰ç³»ç»Ÿâ€œå¯ä»¥é‡‡å–çš„åŠ¨ä½œè¯­ä¹‰â€
* ä¸è´Ÿè´£æ˜¯å¦æ‰§è¡Œ

ðŸ‘‰ **çŽ°å®žå¯¹åº”**ï¼šåœæœº / é™é€Ÿ / æŠ¥è­¦ / åˆ‡æ¢ç­–ç•¥ç­‰åŠ¨ä½œå­—å…¸

---

#### 3.4 State + Reducerï¼ˆä¸–ç•ŒçŽ°åœ¨æ˜¯ä»€ä¹ˆæ ·ï¼‰

```
src/cim_worldlab/world/state/
```

* `WorldState`ï¼šä¸–ç•Œå½“å‰å¿«ç…§
* `reducer`ï¼šçº¯å‡½æ•°
  `state + event â†’ new_state`

**æ ¸å¿ƒåŽŸåˆ™**

* state ä¸å¯å˜ï¼ˆæˆ–é€»è¾‘ä¸Šä¸å¯å˜ï¼‰
* reducer æ— å‰¯ä½œç”¨
* ä¸–ç•ŒçŠ¶æ€å¯å›žæ”¾ã€å¯å¤çŽ°

ðŸ‘‰ **çŽ°å®žå¯¹åº”**ï¼šå·¥åŽ‚å½“å‰çŠ¶æ€ / ç³»ç»Ÿå†…å­˜æ€

---

### 4ï¸âƒ£ Observation & Memoryï¼ˆè§‚å¯Ÿä¸Žè®°å¿†å±‚ï¼‰

#### 4.1 Metricsï¼ˆç®¡ç†è§†è§’ï¼‰

```
src/cim_worldlab/world/metrics/
```

* ä»Ž `state + event_log` è®¡ç®—æŒ‡æ ‡
* ä¾‹å¦‚ï¼šaction_count / last_action_summary

ðŸ‘‰ **çŽ°å®žå¯¹åº”**ï¼šè€æ¿ä»ªè¡¨ç›˜ / ç›‘æŽ§çœ‹æ¿
ðŸ‘‰ **åŽŸåˆ™**ï¼šåªè¯»ã€ä¸æ”¹ä¸–ç•Œ

---

#### 4.2 Persistenceï¼ˆåŽ†å²å­˜æ¡£ / å›žæ”¾ï¼‰

```
src/cim_worldlab/world/persistence/
out/
```

* event log / snapshot
* replay / rewind / fast replay

ðŸ‘‰ **çŽ°å®žå¯¹åº”**ï¼šäº‹æ•…å¤ç›˜ / æ•™å­¦å›žæ”¾ / å®¡è®¡ç•™æ¡£

---

### 5ï¸âƒ£ External World Interfaceï¼ˆå¤–éƒ¨ä¸–ç•ŒæŽ¥å£å±‚ï¼‰

```
src/cim_worldlab/world/gateway/
src/cim_worldlab/plugins/
schemas/
```

**èŒè´£**

* æŽ¥æ”¶å¤–éƒ¨ä¸–ç•Œè¾“å…¥
* æ ¡éªŒ schema
* è½¬åŒ–ä¸º EXTERNAL_INPUT äº‹ä»¶

ðŸ‘‰ **çŽ°å®žå¯¹åº”**ï¼šä¼ æ„Ÿå™¨ã€äººå·¥å½•å…¥ã€å¤–éƒ¨ç³»ç»Ÿ

---

## å››ã€ä¸€æ¬¡å®Œæ•´ä¸–ç•Œè¿è¡Œè·¯å¾„ï¼ˆEnd-to-Endï¼‰

```
å¤–éƒ¨è¾“å…¥
  â†“
gateway â†’ EXTERNAL_INPUT
  â†“
runtime
  â†“
policy â†’ POLICY_DECISION
  â†“
runtime â†’ ACTION_EXECUTED
  â†“
reducer â†’ WorldState æ›´æ–°
  â†“
metrics â†’ æŒ‡æ ‡å¿«ç…§
  â†“
CLI / HTTP / out æ–‡ä»¶
```

---

## äº”ã€æž¶æž„è®¾è®¡çš„æ ¸å¿ƒä»·å€¼ï¼ˆWhy This Architectureï¼‰

* âœ… **å¯è§£é‡Š**ï¼šæ¯ä¸ªåˆ¤æ–­ã€æ¯ä¸ªåŠ¨ä½œéƒ½æœ‰ reason
* âœ… **å¯å›žæ”¾**ï¼šäº‹ä»¶é©±åŠ¨ï¼ŒåŽ†å²å¯é‡å»º
* âœ… **å¯æµ‹è¯•**ï¼šçº¯å‡½æ•° reducer / metrics
* âœ… **å¯æ•™å­¦**ï¼šå·¥ç¨‹ç›´è§‰ â†’ ç³»ç»Ÿå®žçŽ° â†’ æ–‡æ˜ŽæŠ½è±¡

---

## å…­ã€æž¶æž„ä¸€å¥è¯æ€»ç»“ï¼ˆArchitecture Mantraï¼‰

> **Event æ˜¯åŽ†å²ï¼Œ
> State æ˜¯çŽ°åœ¨ï¼Œ
> Reducer æ˜¯è§„å¾‹ï¼Œ
> Runtime æ˜¯ç¼–æŽ’ï¼Œ
> Metrics æ˜¯è§‚å¯Ÿã€‚**

---
